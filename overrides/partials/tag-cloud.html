{% from "partials/colors.html" import color %}

{% set tags=[] %}

{# scan all pages #}
{% for p in pages %}
  {% if p.page.meta.tags %}
    {# extract tags if available #}
    {% for tag in p.page.meta.tags %}
      {% if tags|length %}
        {% set ns = namespace(found=False) %}
        {# read more about scope at
        https://jinja.palletsprojects.com/en/2.11.x/templates/#assignments
        #}
        {# check if tag exists, append to its page list #}
        {% for item in tags %}
          {% set t, ps = item %}
          {% if tag == t %}
            {% set ns.found = True %}
            {# use "" to not add spaces in content #}
            {{ ps.append(p.page) or "" }}
          {% endif %}
        {% endfor %}
        {# if tag doesn't exist, create new page list#}
        {% if not ns.found %}
          {{ tags.append((tag, [p.page])) or "" }}
        {% endif %}
      {% else %}
        {{ tags.append((tag, [p.page])) or "" }}
      {% endif %}
    {% endfor %}
  {% endif %}
{% endfor %}


<div class="md-content" data-md-component="content">
    <h1>标签</h1>
    <hr />
    {% if tags|count %}
        {% for item in tags %}
            {% set tag, ps = item %}
            {# create a link with tag name #}
            {# font size is based on the page count #}
            <a class="tag" href="{{ config.site_url }}tags/#{{ tag }}">
                <span class="tag-name" style="
                    {% set sz = ps|count %}
                        {% if sz > 5 %}
                            {% set sz = 5 %}
                        {% endif %}
                    {% if page.url == 'tags/' %}
                        font-size:{{ 1+sz*0.01}}rem;
                    {% else %}
                        font-size:{{ 1+sz*0.01}}rem;
                    {% endif %}
                    color:{{ color( loop.index%12) }};
                ">
                    {{- tag -}} &nbsp;
                </span>
            </a>
        {% endfor %}
    {% else %}
        <p>
            No tag found!
        </p>
    {% endif %}
</div>
