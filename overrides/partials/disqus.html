{% set disqus = config.extra.disqus %}
{% if page.meta and page.meta.disqus is string %}
{% set disqus = page.meta.disqus %}
{% endif %}

{% if not page.is_homepage and disqus %}
<h2 id="__comments">{{ lang.t("meta.comments") }}</h2>
<div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
        this.page.url = "{{ page.canonical_url }}"
        this.page.identifier =
            "{{ page.canonical_url | replace(config.site_url, '') }}"
    }

    if (typeof DISQUS === "undefined") {
        var script = document.createElement("script")
        script.async = true
        script.src = "https://{{ disqus }}.disqus.com/embed.js"
        script.setAttribute("data-timestamp", Date.now())
        document.body.appendChild(script)
    } else {
        DISQUS.reset({
            reload: true,
            config: disqus_config
        })
    }
</script>
{% endif %}
